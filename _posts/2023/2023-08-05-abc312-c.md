---
title: "ABC312 C問題の考え方"
categories:
    - blog
tags:
    - AtCoder
toc: true
---

[C - Invisible Hand](https://atcoder.jp/contests/abc312/tasks/abc312_c) の考え方を書きました。

# 問題の概要

N 人の売り手がいます。それぞれ A1, A2, ... AN 円以上なら売ると言っています。

* A[1] 🙋 < **150円以上**なら売るよ
* A[2] 🙋 < **160円以上**なら売るよ
* ...
* A[N] 🙋 < **152円以上**なら売るよ

M 人の買い手がいます。それぞれ B1, B2, ... BM 円以下なら買うと言っています。

* B[1] 🙋‍♂️ < **160円以下**なら買うよ
* B[2] 🙋‍♂️ < **150円以下**なら買うよ
* ...
* B[M] 🙋‍♂️ < **155円以下**なら買うよ

このとき、`売り手の人数 >= 買い手の人数` を満たす金額の**最小値**を求めます。  
業務でもありそうな要件ですね（妥当な価格を自動決定する、など）。

問題としてはシンプルですが、ACにはちょっと工夫が必要な楽しい問題だったので、考え方を書きました。

# 考え方

## まずは答えの状況を整理する

答えの状況を想像してみましょう。

「150円で売買する人～」と呼びかけた際、

* 売り手: 🙎 🙋 🙎 🙋 🙋 （合計3人）
* 買い手: 🙋‍♂️ 🙎‍♂️ 🙋‍♂️ 🙎‍♂️ 🙋‍♂️ （合計3人）

となるならば、 `売り手の人数 >= 買い手の人数` を満たします。

さらに、150円未満の**すべての**金額において

* 売り手: 🙎 🙋 🙎 🙎 🙎 （合計1人）
* 買い手: 🙋‍♂️ 🙎‍♂️ 🙋‍♂️ 🙋‍♂️ 🙋‍♂️ （合計4人）

のように `売り手の人数 < 買い手の人数` ならば、"150円" という金額は「`売り手の人数 >= 買い手の人数` を満たす金額の**最小値**」であり、これが答えとなります。

## 極端な金額についても考える

答えの状況はわかりました。しかし、答えとなる金額を一発で求めるのは難しそうです。  
次は、極端な金額、つまり "0円" と "∞円" の場合について考えてみましょう。

「0円で売買する人～」と呼びかけると、

* 売り手: 🙎 🙎 🙎 🙎 🙎 （合計0人）
* 買い手: 🙋‍♂️ 🙋‍♂️ 🙋‍♂️ 🙋‍♂️ 🙋‍♂️ （合計5人）


売り手は当然、タダでは譲ってくれません。（厳密には、制約 `1 ≤ A[i]` によってこれが保証されます。）  
買い手は無料で入手できるため、全員が手を挙げます。（厳密には、制約 `1 ≤ B[i]` によってこれが保証されます。）

「∞円で売買する人～」と呼びかけると、

* 売り手: 🙋 🙋 🙋 🙋 🙋 （合計5人）
* 買い手: 🙎‍♂️ 🙎‍♂️ 🙎‍♂️ 🙎‍♂️ 🙎‍♂️ （合計0人）

売り手は全員が手を挙げます。∞円ほしい。（厳密には、制約 `A[i] ≤ 10^9` によってこれが保証されます。）  
買い手は0人です。（厳密には、制約 `B[i] ≤ 10^9` によってこれが保証されます。）

オークションのように金額を釣り上げていくと、売り手は0人からN人（全員）まで徐々に増えていき、買い手はM人から0人（全員）まで徐々に減っていきます。明らかに、この途中に `売り手の人数 < 買い手の人数` から `売り手の人数 >= 買い手の人数` に変わる瞬間が存在し、その瞬間の金額が答えとなります。  
この様子をイメージしつつ、実装を考えていきましょう。


## 単純な実装とその問題点

上記の考え方をコードで表現すると、次のようになります。

```python
for price in range(0, 10**10):
    # 売り手の人数を数える
    num_seller = 0
    for seller_i in range(0, N):
        if A[seller_i] >= price:
            num_seller += 1

    # 買い手の人数を数える
    num_buyer = 0
    for buyer_i in range(0, M):
        if B[buyer_i] <= price:
            num_buyer += 1

    # 売り手の人数 >= 買い手の人数 となったら、そのときの金額を出力して終了
    if num_seller >= num_buyer:
        print(price)
        break
```

正しい答えを出力することはできますが、この実装には計算量の問題があります。

ここでも極端な値を考えてみます。大きい値が答えになる場合として、答え = 10^9 のケースを考えます。
この場合、外側のforループは、10^9回繰り返されます。  
さらに、そのループの内部で全ての売り手と買い手に対するforループがあります。内側のループは最大で `Nmax + Mmax = 4*10^5` 回繰り返されます。  
つまり、**最もループ数の多い（処理に時間のかかる）ケースでは、 `10^9 * 4*10^5 = 4*10^14` 回ものループが発生します。これでは、"制限時間2秒"に間に合いません。**
